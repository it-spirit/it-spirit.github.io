<!DOCTYPE html>
<!--[if IE 8]> <html lang="en" class="ie8"> <![endif]-->
<!--[if IE 9]> <html lang="en" class="ie9"> <![endif]-->
<!--[if !IE]><!--> <html lang="en"> <!--<![endif]-->

  <head>
        <title>it-spir.it</title>

      <!-- Meta -->
      <meta charset="utf-8" />
      <meta content="width=device-width, initial-scale=1.0" name="viewport" />
      <meta content="" name="description" />
      <meta content="" name="author" />

      <!-- Favicon -->
        <link rel="shortcut icon" href="/favicon.ico" />

      <!-- Web Fonts -->
      <link rel="shortcut" type="text/css" href="//fonts.googleapis.com/css?family=Open+Sans:400,300,600&amp;subset=cyrillic,latin" />

      <!-- CSS Global Compulsory -->
      <link rel="stylesheet" href="/theme/plugins/bootstrap/css/bootstrap.min.css" />
      <link rel="stylesheet" href="/theme/css/style.css" />

      <!-- CSS Header and Footer -->
        <link rel="stylesheet" href="/theme/css/headers/header-v3.css" />
        <link rel="stylesheet" href="/theme/css/footers/footer-v1.css" />

      <!-- CSS Implementing Plugins -->
      <link rel="stylesheet" href="/theme/plugins/animate.css" />
      <link rel="stylesheet" href="/theme/plugins/line-icons/line-icons.css" />
      <link rel="stylesheet" href="/theme/plugins/font-awesome/css/font-awesome.min.css" />

      <!-- CSS Theme -->
      <link rel="stylesheet" href="/theme/css/theme-colors/default.css" />

      <!-- CSS Customization -->
      <link rel="stylesheet" href="/theme/css/custom.css" />

      <!-- Syndication links -->



    <meta name="tags" content="Mercurial" />
    <meta name="tags" content="RhodeCode" />
    <meta name="tags" content="Monitoring" />

  </head>

    <body class="boxed-layout container header-fixed">
    <div class="wrapper">

<!--=== Header v3===-->
  <div class="header-v3 header-sticky">

  <div class="navbar navbar-default mega-menu" role="navigation">
    <div class="container">
      <!-- Brand and toggle get grouped for better mobile display -->
      <div class="navbar-header">
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-responsive-collapse">
          <span class="sr-only">Toggle navigation</span>
          <span class="fa fa-bars"></span>
        </button>
        <a class="navbar-brand" href="/">
            <img src="/theme/img/logo1-default.png" alt="it-spir.it" />
        </a>
      </div>

      <!-- Collect the nav links, forms, and other content for toggling -->
      <div class="collapse navbar-collapse mega-menu navbar-responsive-collapse">
        <div class="container">
          <ul class="nav navbar-nav">
            <!-- Home -->
            <li class="dropdown">
              <a href="javascript:void(0);" class="dropdown-toggle" data-toggle="dropdown">Home</a>
            </li>
            <!-- End Home -->
          </ul>
        </div><!--/end container-->
      </div><!--/navbar-collapse-->
    </div>
  </div>
</div>
<!--=== End Header v3 ===-->
      <!--=== Content Part ===-->
      <div class="container content-sm">
<section id="content" class="body">
  <header>
    <h2 class="entry-title">
      <a href="/blog/rhodecode-remove-outdated-session-data/" rel="bookmark"
         title="Permalink to RhodeCode: remove outdated session data">RhodeCode: remove outdated session data</a></h2>
 
  </header>
  <footer class="post-info">
    <abbr class="published" title="2012-03-31T00:00:00+02:00">
      Sa 31 März 2012
    </abbr>
    <address class="vcard author">
      By           <a class="url fn" href="/author/it-spirit.html">it-spir.it</a>
    </address>
  </footer><!-- /.post-info -->
  <div class="entry-content">
    <p>We use <a class="reference external" href="http://rhodecode.org/">RhodeCode</a> for our internal <a class="reference external" href="http://mercurial.selenic.com/">Mercurial</a> repositories.
It's great for what it does: user and group management, repository groups, etc.</p>
<p>But when I looked at our server today I was kind of shocked about the inode usage on one of our partitions.
Checking out the Munin graphs I realized that it had something todo with our repos.
But the repository folder wasn't that big, only about 160MB.
So I was looking for the inode usage:</p>
<pre class="literal-block">
$ find /opt/repositories/ -type f | wc -l
14110
</pre>
<p>That's not too much.
Also because df shows a usage of about 500.000 inodes.
Ok, checking the RhodeCode directory:</p>
<pre class="literal-block">
$ find /opt/rhodecode/ -type f | wc -l
483992
</pre>
<p>Yes!
But wait.
Where does all the files come from?</p>
<p>RhodeCode uses Beaker for session management.
And by default, file storage is used.
This isn't that bad, but from the Beaker documentation you can see that it could be:</p>
<blockquote>
Beaker does not automatically delete expired or old cookies on any of its back-ends.
This task is left up to the developer based on how sessions are being used, and on what back-end.
The database backend records the last accessed time as a column in the database so a script could be run to delete session rows in the database that haven’t been used in a long time.</blockquote>
<p>So for the file backend that means that all the session files are kept.
Forever!</p>
<p>But help is here!
You can remove outdated session files with a simple command:</p>
<pre class="literal-block">
$ find /opt/rhodecode/data/sessions -mtime +3 -exec rm {} \;
</pre>
<p>This removes all the session files older than 3 days.
The result is amazing:</p>
<pre class="literal-block">
$ find /opt/rhodecode/data/session/ -type f | wc -l
4528
</pre>
<p>If you're lazy like me, simply add a cronjob and let your system do the rest:</p>
<pre class="literal-block">
# m h  dom mon dow   command
0 1 1 * * find /opt/rhodecode/apps/propertyshelf/data/sessions -type f -mtime +3 -exec rm {} \;
</pre>
<p>This removes old session files on every 1st of a month at 1:00am.</p>

  </div><!-- /.entry-content -->
</section>
      </div>

<!--=== Footer Version 1 ===-->
<div class="footer-v1">
  <div class="footer">
    <div class="container">
      <div class="row">
        <!-- About -->
        <div class="col-md-3 md-margin-bottom-40">
          <a href="">
              <img id="logo-footer" class="footer-logo" src="/theme/img/logo2-default.png" alt="">
          </a>
          <p>About Unify dolor sit amet, consectetur adipiscing elit. Maecenas eget nisl id libero tincidunt sodales.</p>
          <p>Duis eleifend fermentum ante ut aliquam. Cras mi risus, dignissim sed adipiscing ut, placerat non arcu.</p>
        </div>
        <!-- End About -->

        <!-- Latest -->
        <div class="col-md-3 md-margin-bottom-40">
          <div class="posts">
            <div class="headline">
              <h2>Latest Posts</h2>
            </div>
            <ul class="list-unstyled latest-list">
              <li><a href="#">Incredible content</a> <small>May 8, 2014</small></li>
              <li><a href="#">Best shoots</a> <small>June 23, 2014</small></li>
              <li><a href="#">New Terms and Conditions</a> <small>September 15, 2014</small></li>
            </ul>
          </div>
        </div>
        <!-- End Latest -->

        <!-- Link List -->
        <div class="col-md-3 md-margin-bottom-40">
          <div class="headline">
            <h2>Useful Links</h2>
          </div>
          <ul class="list-unstyled link-list">
            <li><a href="#">About us</a><i class="fa fa-angle-right"></i></li>
            <li><a href="#">Portfolio</a><i class="fa fa-angle-right"></i></li>
            <li><a href="#">Latest jobs</a><i class="fa fa-angle-right"></i></li>
            <li><a href="#">Community</a><i class="fa fa-angle-right"></i></li>
            <li><a href="#">Contact us</a><i class="fa fa-angle-right"></i></li>
          </ul>
        </div>
        <!-- End Link List -->

        <!-- Address -->
        <div class="col-md-3 map-img md-margin-bottom-40">
          <div class="headline">
            <h2>Contact Us</h2>
          </div>
          <address class="md-margin-bottom-40">
            25, Lorem Lis Street, Orange <br>
            California, US <br>
            Phone: 800 123 3456 <br>
            Fax: 800 123 3456 <br>
            Email: <a href="mailto:info@anybiz.com" class="">info@anybiz.com</a>
          </address>
        </div>
        <!-- End Address -->

      </div>
    </div>
  </div><!--/footer-->

  <div class="copyright">
    <div class="container">
      <p>Copyright 2015 anybiz.com</p>
    </div>
  </div><!--/copyright-->

</div>
<!--=== End Footer Version 1 ===-->
    </div>

    <!-- JS Global Compulsory -->
    <script src="/theme/plugins/jquery/jquery.min.js"></script>
    <script src="/theme/plugins/jquery/jquery-migrate.min.js"></script>
    <script src="/theme/plugins/bootstrap/js/bootstrap.min.js"></script>

    <!-- JS Implementing Plugins -->
    <script src="/theme/plugins/back-to-top.js"></script>

    <!-- JS Customization -->
    <script src="/theme/js/custom.js"></script>

    <!-- JS Page Level -->
    <script src="/theme/js/app.js"></script>
    <script>
      jQuery(document).ready(function() {
        App.init();
      });
    </script>

    <!--[if lt IE 9]>
      <script src="/theme/plugins/respond.js"></script>
      <script src="/theme/plugins/html5shiv.js"></script>
      <script src="/theme/plugins/placeholder-IE-fixes.js"></script>
    <![endif]-->
  </body>
</html>